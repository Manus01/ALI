# ALI Application Technical Overview

## Deployment and Runtime
- **Hosting model**: Vite builds a static React SPA that is served by a thin Express wrapper. Cloud Run can execute `node src/server.js`, which serves the built assets from `/dist` with gzip-friendly caching, MIME handling, and SPA fallback routing. `PORT` defaults to `8080`; the Express `x-powered-by` header is disabled.【F:src/server.js†L1-L78】
- **Build & start commands**: `npm run build` (runs Vite build + Tailwind CSS minification) and `npm run start` (Express). Individual scripts `build-react`, `build:css`, and `watch:css` exist for CI/CD or local development.【F:package.json†L5-L28】
- **Environment variables**: `PORT` for the server; no other env vars are consumed. **Firebase config (API key, project IDs, etc.) is hard-coded in `src/firebase.js` and therefore baked into the client bundle.**【F:src/firebase.js†L1-L17】
- **Repository layout (key files)**: React sources in `src/`; Tailwind entry `src/index.css`; Express server `src/server.js`; Vite config `vite.config.js`; build artifacts in `/dist`; Firebase client in `src/firebase.js`.
- **Cloud Run deployment flow (current)**: Build image (Cloud Build or local) → container runs `npm install`, `npm run build`, then `npm run start` on boot. No health checks, readiness probes, or environment-based config are defined; Cloud Run revision updates must redeploy to change Firebase projects or secrets. A basic Dockerfile copies the repo, installs production dependencies, runs the build, and exposes `PORT` (default 8080).【F:Dockerfile†L1-L16】
- **Operational notes**: No logging framework beyond `console.log`; no metrics/health endpoints; HTTPS termination handled by Cloud Run; static hosting means cache-control headers are set by Express (7-day max-age) but Cloud CDN is not configured. Cloud Build configuration (`cloudbuild.yaml`) only runs `npm install` + `npm run build`, and does not push images or run tests.【F:cloudbuild.yaml†L1-L12】
- **Local development**: `npm install` (Node 18+) → `npm run dev` for Vite with HMR; `npm run watch:css` for Tailwind in watch mode. `npm run build` + `npm run start` emulate Cloud Run locally. No .env file is required because Firebase config is in source.

## Core Dependencies
- **Runtime**: Node.js with Express to host the SPA.【F:src/server.js†L1-L78】
- **Frontend**: React (latest), React Router v6 (SPA navigation), Tailwind CSS (utility styling), Vite (bundler/dev server).【F:package.json†L5-L28】
- **Data & Auth**: Firebase v9 modular SDK (Auth, Firestore). Auth is initialized but not used in UI; Firestore is heavily used for integration/tutorial/suggestion documents.【F:src/firebase.js†L1-L17】【F:src/App.jsx†L20-L103】
- **Visualization**: Chart.js + react-chartjs-2 for dashboard charts.【F:package.json†L13-L28】
- **Tooling**: Tailwind CLI, PostCSS, Autoprefixer, Vite React plugin for build pipeline.【F:package.json†L5-L28】
- **Notable versions** (from `package.json`): React 18.3, React Router 6.22, Firebase 10.12, Chart.js 4.4, Tailwind 3.4, Vite 5.2.【F:package.json†L5-L28】

## Firebase Configuration and Secrets Handling
- `firebaseConfig` (API key, project IDs, measurement ID) is committed in `src/firebase.js`, meaning every deployed bundle exposes these values. No environment overrides are implemented. While Firebase API keys are not strictly secret, storing project identifiers client-side allows unrestricted reads/writes according to Firestore security rules (none are enforced in this frontend-only setup).【F:src/firebase.js†L1-L17】
- Firestore is the sole data store; calls originate directly from the browser with no backend proxy. All credentials entered in the UI are persisted directly from the client into Firestore documents (unencrypted).【F:src/components/IntegrationModal.jsx†L1-L91】【F:src/hooks/useIntegrations.js†L19-L87】
- Firestore security rules are absent in this repo; unless configured externally, all client-side writes will succeed using the baked-in config. There is no server-side validation, rate limiting, or field-level encryption.

## Firebase Integration
- Firebase initialized with hard-coded project credentials; Firestore and Auth instances are exported. Auth is not yet wired into the UI (the app uses a stub `useAuth` returning `null`).【F:src/firebase.js†L1-L17】【F:src/App.jsx†L20-L60】
- Firestore collections used by hooks:
  - `user_integrations`: stores per-user integration status, credentials, validation codes, and last sync time.【F:src/hooks/useIntegrations.js†L39-L87】
  - `tutorials`: master tutorial documents generated by AI placeholders.【F:src/hooks/useTutorials.js†L48-L76】
  - `user_tutorials`: user-specific tutorial state including completion, format preferences, regeneration history, scores, and ratings.【F:src/hooks/useTutorials.js†L15-L170】
  - `tutorial_versions`: archive of previous tutorial versions when quizzes fail or format switches occur.【F:src/hooks/useTutorials.js†L78-L147】
  - `suggestions`: AI-generated campaign suggestions with optional evaluations.【F:src/hooks/useAISuggestions.js†L9-L70】

## Feature Overview
### Routing and Onboarding Flow
- Navigation UI: Top nav links (Dashboard, Integrations, Strategy, Learning) plus Theme toggle; footer renders current year.【F:src/App.jsx†L62-L113】
- Route map with guards (lazy loaded for code-splitting):
  - `/` → redirect: logged-in user → `/dashboard`; otherwise `/login`. Auth stub always reports no user, so redirects to `/login` by default.【F:src/App.jsx†L20-L103】
  - `/login`, `/register`, `/forgot-password` → auth UIs only; no Firebase Auth wiring yet.【F:src/App.jsx†L91-L103】
  - `/quiz/hft`, `/quiz/marketing`, `/quiz/eq` → onboarding quizzes (hidden figures, marketing, EQ) that must all be “completed” to satisfy onboarding guard heuristics.【F:src/App.jsx†L27-L104】
  - `/dashboard`, `/strategy` → wrapped in `OnboardingGuard`: requires a `user`, `completed` tutorial count ≥3, and at least one integration with status `OK`. Otherwise redirects to quizzes or `/integrations`.【F:src/App.jsx†L27-L104】
  - `/integrations`, `/tutorials` → public routes (no guard).【F:src/App.jsx†L91-L103】

### Route Treemap
- `/`
  - `redirect → /dashboard | /login`
- `/login`
- `/register`
- `/forgot-password`
- `/quiz`
  - `/quiz/hft`
  - `/quiz/marketing`
  - `/quiz/eq`
- `/dashboard` (guarded)
- `/strategy` (guarded)
- `/integrations`
- `/tutorials`
  - `/tutorials/:id?` (UI reads `user_tutorials` by topic/format and shows generated content; `id` is not enforced in route file but is used as a key in Firestore documents)【F:src/pages/TutorialsPage.jsx†L4-L80】【F:src/hooks/useTutorials.js†L15-L170】

### Client-visible API surface (browser → Firestore)
- `saveCredentials(platform, credentials)`: Writes `{platform}_credentials`, `{platform}_status`, `validationCode`, `validationMessage`, and timestamps to `user_integrations`. Caller trusts local validation only.【F:src/hooks/useIntegrations.js†L19-L87】
- `generateTutorial(topic, format)`: Creates/updates documents in `tutorials` and `user_tutorials`; placeholder AI generation with random quiz pass/fail drives archival to `tutorial_versions` on failure.【F:src/hooks/useTutorials.js†L48-L170】【F:src/pages/TutorialsPage.jsx†L42-L80】
- `toggleCompletion/tutorial ratings`: Updates `user_tutorials` completion, ratings, and scores directly from the UI.【F:src/hooks/useTutorials.js†L15-L170】【F:src/pages/TutorialsPage.jsx†L60-L80】
- `generateSuggestions()` / `evaluateSuggestion`: Creates two canned suggestions in `suggestions` and records evaluations (thumbs up/down, comments).【F:src/hooks/useAISuggestions.js†L9-L70】【F:src/pages/Dashboard.jsx†L58-L222】

### Dashboard
- Simulated campaign metrics rendered via Chart.js with range selector (7/14/30 days) and KPIs (CTR, conversion rate, CPC, learner score).【F:src/pages/Dashboard.jsx†L11-L147】
- Learner profile summarizes classification from integrations, tutorial progress, and ranks; progress is derived from Firestore tutorial documents.【F:src/pages/Dashboard.jsx†L49-L176】
- Integration health widget highlights problematic connections and links to Integrations page.【F:src/pages/Dashboard.jsx†L178-L216】
- "Generate AI Suggestions" opens a modal populated via Firestore-saved placeholder recommendations and supports evaluation feedback logging.【F:src/pages/Dashboard.jsx†L24-L222】【F:src/hooks/useAISuggestions.js†L9-L70】

### Integrations
- Platform catalog covers Facebook, Instagram, OpenAI, LinkedIn, Google Analytics/Adwords, Facebook Ads, Yandex Ads, and Bing Ads; statuses and last sync times are read from Firestore. Cards provide a Manage action that opens the configuration modal.【F:src/hooks/useIntegrations.js†L7-L87】【F:src/pages/Integrations.jsx†L31-L84】
- `IntegrationModal` dynamically renders credential fields per platform, performs lightweight client validation, and persists to Firestore with server-side placeholder validation/metadata (status, code, message, last sync, stored credentials).【F:src/components/IntegrationModal.jsx†L1-L91】【F:src/hooks/useIntegrations.js†L19-L87】
 - **Credential risk**: All secret-like inputs (API tokens, client IDs, etc.) are persisted unencrypted to Firestore from the browser. There is no token exchange or obfuscation layer, so any user with Firestore access can read them; leaked config could allow third-party account takeover.

### Tutorials & Learning
- Users can generate AI-tailored tutorials by topic and preferred format (text/visual/video). Generation stores content in `tutorials` and user links in `user_tutorials`.【F:src/pages/TutorialsPage.jsx†L4-L40】【F:src/hooks/useTutorials.js†L48-L76】
- Available tutorials support quizzes (randomized pass/fail), thumbs up/down ratings, and format switching that archives prior versions and regenerates with placeholder AI checks before replacing content.【F:src/pages/TutorialsPage.jsx†L42-L80】【F:src/hooks/useTutorials.js†L78-L170】
- Completed tutorials display scores; overall progress informs the dashboard learner profile and onboarding gating logic.【F:src/pages/TutorialsPage.jsx†L68-L80】【F:src/App.jsx†L27-L56】

### AI Suggestions
- Placeholder generator produces two canned optimization ideas, stores them in `suggestions` with campaign snapshots, and displays them via a modal on the dashboard. Users can submit feedback which is recorded as evaluations in Firestore.【F:src/pages/Dashboard.jsx†L58-L222】【F:src/hooks/useAISuggestions.js†L9-L70】

### Theme Management
- `useDarkMode` hook stores theme preference (light/dark/system) in `localStorage`, syncs with `prefers-color-scheme`, and toggles the `dark` class on `documentElement`. Likely used by `ThemeToggle` (not shown).【F:src/hooks/useDarkMode.js†L1-L67】

## Data Model & Logic Details
- **user_integrations** (per user): Keys such as `{platform}_status`, `{platform}_lastSync`, `{platform}_credentials`, `validationCode`, `validationMessage`. Writes happen directly from the browser when saving credentials. Integration health on the dashboard and onboarding guard rely on `{platform}_status === 'OK'`.【F:src/hooks/useIntegrations.js†L19-L87】【F:src/pages/Dashboard.jsx†L178-L216】【F:src/App.jsx†L27-L56】
- **tutorials** (global templates): AI-generated tutorial content keyed by topic/format. Created when users request new tutorials.【F:src/hooks/useTutorials.js†L48-L76】
- **user_tutorials** (user progress): Tracks completion, quiz attempts, scores, ratings, format preferences, and regeneration history. Failures can trigger creation of archived versions in `tutorial_versions`. Onboarding completion is derived from `completed.length >= 3`.【F:src/hooks/useTutorials.js†L15-L170】【F:src/App.jsx†L27-L56】
- **tutorial_versions** (archives): Stores previous versions when quizzes fail or formats change to preserve history. Allows rollback/inspection but currently only written, not read in UI.【F:src/hooks/useTutorials.js†L78-L147】
- **suggestions**: AI optimization ideas plus campaign snapshots and optional evaluation feedback stored as subdocuments/fields; surfaced in a dashboard modal.【F:src/hooks/useAISuggestions.js†L9-L70】【F:src/pages/Dashboard.jsx†L24-L222】
- **Client-side logic**: Integration validation is mocked (no API calls); quiz outcomes are random; AI text is placeholder. All writes happen client-side via Firestore SDK with no server-side verification.

## Known Gaps & Risks (for planning)
- **Authentication**: UI uses a stubbed `useAuth` returning `null`, so onboarding guards always redirect to login; Firebase Auth is initialized but unused. Firestore operations rely on fallback IDs, not the authenticated user context.【F:src/App.jsx†L20-L60】【F:src/hooks/useIntegrations.js†L5-L87】【F:src/hooks/useTutorials.js†L5-L170】
- **Secrets handling**: Firebase config (including API key and project IDs) is committed to source, and integration credentials are stored directly in Firestore from the client without encryption or token exchange flows. No backend exists to broker OAuth or store secrets securely.【F:src/firebase.js†L1-L17】【F:src/components/IntegrationModal.jsx†L1-L91】【F:src/hooks/useIntegrations.js†L19-L87】
- **Data accuracy**: Campaign metrics, AI content, and validation outcomes are mocked; quiz pass/fail is random. No backend verification or real third-party API calls exist.【F:src/pages/Dashboard.jsx†L11-L222】【F:src/pages/TutorialsPage.jsx†L9-L80】
- **Security**: Express server only serves static assets; no API endpoints or middleware (CORS, auth, rate limiting). SPA bundles include all Firestore logic and configuration, so sensitive information should never be added to the client. Guards are client-side only.【F:src/server.js†L1-L78】
- **Routing accessibility**: `/integrations` and `/tutorials` are public; depending on requirements, integration UI may be exposed to unauthenticated users. Onboarding guard heuristics can be bypassed by directly navigating to unguarded routes.【F:src/App.jsx†L88-L104】
- **Operational readiness**: No automated tests, linting, or monitoring are present. Build-time failures or runtime exceptions would surface only via Cloud Run logs. There is no migration plan for Firestore schema changes or data backfills.
- **Data governance**: No retention, PII classification, or backup strategy is documented for Firestore collections. User-entered third-party credentials and learning history could persist indefinitely with no expiry.
- **Performance & reliability**: Heavy client-side Firestore writes can thrash quota if traffic scales; there is no offline handling or retry logic. Charts and modals pull all data in-page; lack of pagination or query limits could inflate bundle memory on large datasets.

## Data Flows
1. **Integration setup**: User opens modal → enters credentials → client validation → `saveCredentials` writes status and credentials to `user_integrations` → dashboard reads statuses to flag issues and onboarding guard checks for at least one OK status.【F:src/components/IntegrationModal.jsx†L31-L91】【F:src/hooks/useIntegrations.js†L39-L87】【F:src/pages/Dashboard.jsx†L23-L216】【F:src/App.jsx†L27-L56】
2. **Tutorial lifecycle**: User generates tutorial → records in `tutorials` and `user_tutorials` → quizzes/ratings update `user_tutorials`; failed quizzes archive versions and regenerate content after placeholder evaluation.【F:src/hooks/useTutorials.js†L48-L170】【F:src/pages/TutorialsPage.jsx†L42-L80】
3. **AI suggestions**: Dashboard triggers generation → suggestions saved to `suggestions` → modal displays them; evaluations write back to the same documents.【F:src/pages/Dashboard.jsx†L58-L222】【F:src/hooks/useAISuggestions.js†L9-L70】

## UX Notes
- Visual design leans on gradients and glassmorphism; cards and modals follow Tailwind utility classes. Theme toggle supports dark/system modes. Dashboard emphasizes KPIs and learner progress with charts and cards.【F:src/App.jsx†L62-L112】【F:src/pages/Dashboard.jsx†L80-L200】

## Suggested Next Steps (high level)
- Wire Firebase Auth and remove hard-coded user IDs; secure integration credentials via server-side token exchange and secrets management.
- Replace placeholder data with real API clients for ad platforms and analytics; move validation to backend services.
- Harden routing (protect integration/tutorial routes), add role-based access, and enforce HTTPS/secure cookies in Cloud Run.
- Add CI/CD checks (lint/tests), environment-based config, and monitoring/logging for Cloud Run deployments.
